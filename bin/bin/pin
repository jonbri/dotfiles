#!/bin/bash
# pin - git push origin `branch`

ARG=$1
BRANCH=`git rev-parse --abbrev-ref HEAD`;

git fetch

if [[ `git status --porcelain` ]]; then
    echo "outstanding changes"
    git status --short
    read -p "amend? (press enter) " yn
    git add . && git commit --quiet --amend --reuse-message=HEAD
fi

if [ "$ARG" = "--yes" ] || [ "$ARG" = "-y" ]; then
    echo "skipping confirmation"
else
    if [ ! `git rev-parse --verify origin/$BRANCH 2>/dev/null` ]; then
        echo "origin/$BRANCH does not exist"
    else
        left-right
    fi

    read -p "git push --force origin $BRANCH (press enter) " yn
fi

reflog pin_$BRANCH
git push --force origin $BRANCH
echo "done"

