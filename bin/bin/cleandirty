#!/bin/bash

if [[ ! `isgit` = "true" ]]; then
    exit 1
fi

NUM_OF_CHANGES=`git status --porcelain=v1 2>/dev/null | wc -l`
if [ "$NUM_OF_CHANGES" = "0" ]; then
    echo "clean"
    exit 0
fi

WORKING_DIR_SHORTHAND=""
if ! output=$(git diff --exit-code); then
    WORKING_DIR_SHORTHAND="w"
fi


CACHE_SHORTHAND=""
if ! output=$(git diff --cached --exit-code); then
    CACHE_SHORTHAND="c"
fi

UNTRACKED_SHORTHAND=""
untracked=`git ls-files -z -o --exclude-standard | sed q1`;
# untracked=`git ls-files -z -o --exclude-standard`;
if [ ! -z "${untracked}" ]; then
    UNTRACKED__SHORTHAND="u"
fi

SEPARATOR=""
if [ "$WORKING_DIR_SHORTHAND" != "" ] || [ "$CACHE_SHORTHAND" != "" ] || [ "$UNTRACKED__SHORTHAND" != "" ]; then
    SEPARATOR="-"
fi

echo "dirty${SEPARATOR}${WORKING_DIR_SHORTHAND}${CACHE_SHORTHAND}${UNTRACKED__SHORTHAND}"
exit 0

